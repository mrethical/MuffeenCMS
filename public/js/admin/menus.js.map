{"version":3,"sources":["menus.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"menus.js","sourcesContent":["\nfunction generatePosts(result) {\n    var html = '<option value=\"\">NONE</option>';\n    for(var key in result) {\n        html += '<option value=\"' + key + '\">' + result[key] + '</option>';\n    }\n    $('#menu-post').empty();\n    $('#menu-post').append($(html));\n}\n\nfunction generateParentMenus(result) {\n    var html = '<option value=\"\">NONE</option>';\n    for(var i = 0; i < result.length; i++) {\n        html += '<option value=\"' + result[i].id + '\">' + result[i].name + '</option>';\n    }\n    $('#menu-parent').empty();\n    $('#menu-parent').append($(html));\n}\n\nfunction refreshTable(html) {\n    $('div#table-container').empty();\n    $('div#table-container').append(html);\n}\n\nfunction reloadTable() {\n    var success = function (result) {\n        refreshTable(result);\n        generatePagination();\n    }\n    callback('GET', 'admin/menus', 'html', {output: 'table'}, success);\n}\n\nfunction generatePagination() {\n    var count = $('input#total-record').val();\n    var limit = 10;\n    $('.pagination').pagination({\n        items: count,\n        itemsOnPage: limit,\n        onPageClick: function(pageNumber){\n            $('.pagination').pagination('disable');\n            var success = function(result){\n                refreshTable(result);\n                $('.pagination').pagination('enable');\n            }\n            callback('GET', 'admin/menus', 'html', {output: 'table', limit: limit, offset: (pageNumber - 1) * limit }, success);\n        }\n    });\n}\n\nfunction resetErrors() {\n    $('#modal-menu-form-name').removeClass('has-error');\n    $('#modal-menu-form-name .help-block').remove();\n    $('#modal-menu-form-parent').removeClass('has-error');\n    $('#modal-menu-form-parent .help-block').remove();\n}\n\nvar success = function(result){\n    if (result.success){\n        reloadTable();\n        $('#modal-menu').modal('hide');\n        $('#modal-menu-submit').prop('disabled', false);\n    }\n}\n\nvar error = function(response) {\n    if (response.status === 422) {\n        for (var key in response.responseJSON) {\n            var value = response.responseJSON[key];\n            $('#modal-menu-form-' + key).addClass('has-error');\n            $('#modal-menu-form-' + key).append('<p class=\"help-block\">' + value + '</p>');\n        }\n        $('#modal-menu-submit').prop('disabled', false);\n    }\n}\n\nvar prepForm = function() {\n    $('#modal-menu-submit').prop('disabled', true);\n    resetErrors();\n}\n\n$(function() {\n    $('#modal-menu').on('show.bs.modal', function (event) {\n        // load data\n        var button = $(event.relatedTarget);\n        var action = button.data('action');\n        var id = button.data('id') || 0;\n        var name = button.data('name');\n        var post_id = button.data('post-id');\n        var parent_id = button.data('parent-id');\n        // set data\n        $('#modal-menu-label').text(action);\n        $('#menu-id').val(id);\n        $('#menu-name').val(name);\n        // load post select\n        callback('GET', 'admin/posts', 'json', [], function(result) {\n            generatePosts(result);\n            if (post_id) $('#menu-post').val(post_id);\n        });\n        // load parent select\n        callback('GET', 'admin/menus/possible_parents/' + id, 'json', [], function(result) {\n            generateParentMenus(result);\n            if (parent_id) $('#menu-parent').val(parent_id);\n        });\n        // if submit add new\n        if (action == 'Add New') {\n            $('#modal-menu-submit').click(function() {\n                prepForm();\n                var data = {\n                    name: $('#menu-name').val(),\n                    post_id: $('#menu-post').val(),\n                    parent: $('#menu-parent').val(),\n                    _token: $('input#menu-post-token').val()\n                };\n                callback('POST', 'admin/menus', 'json', data, success, error);\n            });\n        }\n        // if submit edit\n        else if (action == 'Edit') {\n            $('#modal-menu-submit').click(function() {\n                prepForm();\n                var data = {\n                    name: $('#menu-name').val(),\n                    post_id: $('#menu-post').val(),\n                    parent: $('#menu-parent').val(),\n                    _token: $('input#menu-post-token').val(),\n                    _method: 'PATCH'\n                };\n                callback('POST', 'admin/menus/' + $('#menu-id').val(), 'json', data, success, error);\n            });\n        }\n    });\n    $('#modal-menu').on('hide.bs.modal', function (event) {\n        $('#modal-menu-submit').unbind('click');\n        resetErrors();\n    });\n    $('#modal-menu-delete').on('show.bs.modal', function (event) {\n        var button = $(event.relatedTarget);\n        var id = button.data('id');\n        $('#modal-menu-delete-submit').click(function() {\n            $('#modal-menu-delete').modal('hide');\n            var data = {\n                _token: $('input#menu-post-token').val(),\n                _method: 'DELETE'\n            };\n            var success = function(result){\n                if (result.success = true){\n                    reloadTable();\n                }\n            }\n            callback('POST', 'admin/menus/' + id, 'json', data, success);\n        });\n    })\n\n    generatePagination();\n\n    $(document).on(\"keypress\", \"form\", function(event) {\n        return event.keyCode != 13;\n    });\n\n});"]}