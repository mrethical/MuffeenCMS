{"version":3,"sources":["posts-categories.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"posts-categories.js","sourcesContent":["\r\nfunction generateParentCategories(result) {\r\n    var html = '<option value=\"\">NONE</option>';\r\n    for(var i = 0; i < result.length; i++) {\r\n        html += '<option value=\"' + result[i].id + '\">' + result[i].name + '</option>';\r\n    }\r\n    $('#category-parent').empty();\r\n    $('#category-parent').append($(html));\r\n}\r\n\r\nfunction refreshTable(html) {\r\n    $('div#table-container').empty();\r\n    $('div#table-container').append(html);\r\n}\r\n\r\nfunction reloadTable() {\r\n    var success = function (result) {\r\n        refreshTable(result);\r\n        generatePagination();\r\n    }\r\n    callback('GET', 'admin/posts/categories', 'html', {output: 'table'}, success);\r\n}\r\n\r\nfunction generatePagination() {\r\n    var count = $('input#total-record').val();\r\n    var limit = 10;\r\n    $('.pagination').pagination({\r\n        items: count,\r\n        itemsOnPage: limit,\r\n        onPageClick: function(pageNumber){\r\n            $('.pagination').pagination('disable');\r\n            var success = function(result){\r\n                refreshTable(result);\r\n                $('.pagination').pagination('enable');\r\n            }\r\n            callback('GET', 'admin/posts/categories', 'html', {output: 'table', limit: limit, offset: (pageNumber - 1) * limit }, success);\r\n        }\r\n    });\r\n}\r\n\r\nfunction resetErrors() {\r\n    $('#modal-category-form-name').removeClass('has-error');\r\n    $('#modal-category-form-name .help-block').remove();\r\n    $('#modal-category-form-parent').removeClass('has-error');\r\n    $('#modal-category-form-parent .help-block').remove();\r\n}\r\n\r\nvar success = function(result){\r\n    if (result.success){\r\n        reloadTable();\r\n        $('#modal-category').modal('hide');\r\n        $('#modal-category-submit').prop('disabled', false);\r\n    }\r\n}\r\n\r\nvar error = function(response) {\r\n    if (response.status === 422) {\r\n        for (var key in response.responseJSON) {\r\n            var value = response.responseJSON[key];\r\n            $('#modal-category-form-' + key).addClass('has-error');\r\n            $('#modal-category-form-' + key).append('<p class=\"help-block\">' + value + '</p>');\r\n        }\r\n        $('#modal-category-submit').prop('disabled', false);\r\n    }\r\n}\r\n\r\nvar prepForm = function() {\r\n    $('#modal-category-submit').prop('disabled', true);\r\n    resetErrors();\r\n}\r\n\r\n$(function() {\r\n    $('#modal-category').on('show.bs.modal', function (event) {\r\n        // load data\r\n        var button = $(event.relatedTarget);\r\n        var action = button.data('action');\r\n        var id = button.data('id') || 0;\r\n        var name = button.data('name');\r\n        var parent_id = button.data('parent-id');\r\n        // set data\r\n        $('#modal-category-label').text(action);\r\n        $('#category-id').val(id);\r\n        $('#category-name').val(name);\r\n        // load parent select\r\n        callback('GET', 'admin/posts/categories/possible_parents/' + id, 'json', [], function(result) {\r\n            generateParentCategories(result, parent_id);\r\n            if (parent_id) $('#category-parent').val(parent_id);\r\n        });\r\n        // if submit add new\r\n        if (action == 'Add New') {\r\n            $('#modal-category-submit').click(function() {\r\n                prepForm();\r\n                var data = { name: $('#category-name').val(), parent: $('#category-parent').val(), _token: $('input#category-post-token').val() };\r\n                callback('POST', 'admin/posts/categories', 'json', data, success, error);\r\n            });\r\n        }\r\n        // if submit edit\r\n        else if (action == 'Edit') {\r\n            $('#modal-category-submit').click(function() {\r\n                prepForm();\r\n                var data = {\r\n                    name: $('#category-name').val(),\r\n                    parent: $('#category-parent').val(),\r\n                    _token: $('input#category-post-token').val(),\r\n                    _method: 'PATCH'\r\n                };\r\n                callback('POST', 'admin/posts/categories/' + $('#category-id').val(), 'json', data, success, error);\r\n            });\r\n        }\r\n    });\r\n    $('#modal-category').on('hide.bs.modal', function (event) {\r\n        $('#modal-category-submit').unbind('click');\r\n        resetErrors();\r\n    });\r\n    $('#modal-category-delete').on('show.bs.modal', function (event) {\r\n        var button = $(event.relatedTarget);\r\n        var id = button.data('id');\r\n        $('#modal-category-delete-submit').click(function() {\r\n            $('#modal-category-delete').modal('hide');\r\n            var data = {\r\n                _token: $('input#category-post-token').val(),\r\n                _method: 'DELETE'\r\n            };\r\n            var success = function(result){\r\n                if (result.success = true){\r\n                    reloadTable();\r\n                }\r\n            }\r\n            callback('POST', 'admin/posts/categories/' + id, 'json', data, success);\r\n        });\r\n    })\r\n\r\n    generatePagination();\r\n\r\n    $(document).on(\"keypress\", \"form\", function(event) {\r\n        return event.keyCode != 13;\r\n    });\r\n\r\n});"]}